<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã¨Î†§Îùº, Î∞±ÏóîÎìú!</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .game-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .selection-area {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .character-select {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .character-option {
            cursor: pointer;
            width: 80px;
            border: 3px solid transparent;
            border-radius: 8px;
            padding: 5px;
            transition: all 0.2s;
        }
        .character-option.selected {
            border-color: #3498db;
            background-color: #ebf5fb;
        }
        .character-option img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        .character-option p {
            margin: 5px 0 0;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .race-track {
            background-color: #e9f5f9;
            border: 2px solid #3498db;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
        }
        .character {
            display: flex;
            align-items: center;
            margin: 15px 0;
            height: 60px;
            position: relative;
        }
        .character-name {
            width: 100px;
            text-align: right;
            padding-right: 10px;
            font-weight: bold;
            font-size: 14px;
        }

        .runner {
            position: absolute;
            left: 0;
            top: 0;
            height: 60px;
            width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left 0.3s linear;
        }

        .runner img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        .track {
            flex-grow: 1;
            height: 60px;
            background-color: #ecf0f1;
            border-radius: 15px;
            position: relative;
        }
        .finish-line {
            position: absolute;
            right: 0;
            top: 0;
            height: 60px;
            width: 2px;
            background-color: #e74c3c;
        }
        .results {
            margin-top: 20px;
            text-align: left;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .winner {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        .winner img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .controls {
            margin: 15px 0;
        }
        .result-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        .result-item img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        @keyframes wobble {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(-5deg) translateY(-2px); }
            75% { transform: rotate(5deg) translateY(2px); }
        }
        .running {
            animation: wobble 0.5s infinite;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üèÅ Îã¨Î†§Îùº, Î∞±ÏóîÎìú! üèÅ</h1>
        
        <div class="selection-area" id="selectionArea">
            <h3>Îã¨Î¶¨Í∏∞Ïóê Ï∞∏Ïó¨Ìï† ÌåÄÏõêÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h3>
            <div class="character-select" id="characterSelect">
                <!-- Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù ÏòµÏÖòÎì§Ïù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
            </div>
            <p id="selectionInfo">0Î™Ö ÏÑ†ÌÉùÎê®</p>
            <button class="btn" id="confirmSelectionBtn" disabled>ÏÑ†ÌÉù ÏôÑÎ£å</button>
        </div>
        
        <div class="race-track" id="raceTrack" style="display: none;">
            <!-- ÏÑ†ÌÉùÎêú Ï∫êÎ¶≠ÌÑ∞Îì§Ïù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
        
        <div class="controls">
            <button class="btn" id="startRaceBtn" onclick="startRace()" style="display: none;">Îã¨Î†§!</button>
            <button class="btn" id="newRaceBtn" onclick="resetGame()" style="display: none;">Îã§Ïãú Îã¨Î†§!</button>
        </div>
        
        <div class="results" id="results" style="display: none;">
            <h2>Í≤∞Í≥º</h2>
            <div id="ranking"></div>
            <div id="winner" class="winner"></div>
        </div>
    </div>

    <script>
        // 11Î™ÖÏùò ÌåÄÏõê Ï†ïÎ≥¥ (Ïã§Ï†ú Ïù¥ÎØ∏ÏßÄÎäî ÌîåÎ†àÏù¥Ïä§ÌôÄÎçîÎ°ú ÎåÄÏ≤¥ÎêòÏñ¥ ÏûàÏäµÎãàÎã§)
        const teamMembers = [
            { id: 1, name: "Í∞ïÏßÑÏÜî", img: "https://ca.slack-edge.com/T03385HMGMD-U0894U7NFE0-ga1a417812ff-512", color: "#e84393" },
            { id: 2, name: "ÍπÄÏ∂òÏÑ±", img: "https://ca.slack-edge.com/T03385HMGMD-U051068D1F1-7926bd44a9eb-512", color: "#00b894" },
            { id: 3, name: "ÎØºÍ≤ΩÏàò", img: "https://ca.slack-edge.com/T03385HMGMD-U03M10B51M4-4f366cd9d5d0-512", color: "#fdcb6e" },
            { id: 4, name: "Ïã†Ïú§Ï≤†", img: "https://ca.slack-edge.com/T03385HMGMD-U055KQ0C9EJ-94055df75db2-512", color: "#e17055" },
            { id: 5, name: "ÏïàÏßÑÏÑ±", img: "https://ca.slack-edge.com/T03385HMGMD-U053JLRJCUC-844c38e0c496-512", color: "#6c5ce7" },
            { id: 6, name: "Ïú†Ï∂©ÎØº", img: "https://ca.slack-edge.com/T03385HMGMD-U044WANFJ05-e813de60fa49-512", color: "#2d3436" },
            { id: 7, name: "Ïú§ÌòïÏ§ë", img: "https://ca.slack-edge.com/T03385HMGMD-U064BG82VLK-b63d474f4efc-512", color: "#ff7675" },
            { id: 8, name: "ÏûÑÌòïÏ§Ä", img: "https://ca.slack-edge.com/T03385HMGMD-U043TRJGXMH-634905b61ab0-512", color: "#74b9ff" },
            { id: 9, name: "Ï†ïÏó∞Ïû¨", img: "https://ca.slack-edge.com/T03385HMGMD-U03EHKUTDD5-bcdb33a801c4-512", color: "#a29bfe" },
            { id: 10, name: "Ï°∞Í≤ΩÌòÑ", img: "https://ca.slack-edge.com/T03385HMGMD-U03HTSNCV09-f46ad9c6e485-512", color: "#55efc4" },
            { id: 11, name: "ÏµúÌòÑÍµ¨", img: "https://ca.slack-edge.com/T03385HMGMD-U052TE3TKA5-351357c25e7f-512", color: "#fab1a0" }
        ];
        
        let selectedCharacters = [];
        let raceParticipants = [];
        let raceResults = [];
        let raceFinished = false;
        let raceID = generateRaceID();
        let runnerIntervals = [];
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.onload = function() {
            // URLÏóêÏÑú ÏãúÎìú Í∞íÍ≥º ÏÑ†ÌÉùÎêú Ï∞∏Í∞ÄÏûê ÌôïÏù∏
            const urlParams = new URLSearchParams(window.location.search);
            const seed = urlParams.get('seed');
            const participants = urlParams.get('participants');
            
            if (seed && participants) {
                // ÎØ∏Î¶¨ ÏÑ§Ï†ïÎêú Ï∞∏Í∞ÄÏûêÏôÄ ÏãúÎìúÍ∞Ä ÏûàÎäî Í≤ΩÏö∞
                Math.seedrandom(seed);
                const participantIds = participants.split(',').map(id => parseInt(id));
                raceParticipants = teamMembers.filter(member => participantIds.includes(member.id));
                
                // ÏÑ†ÌÉù ÌôîÎ©¥ Ïà®Í∏∞Í≥† Î†àÏù¥Ïä§ ÌôîÎ©¥ ÌëúÏãú
                document.getElementById('selectionArea').style.display = 'none';
                setupRace();
                document.getElementById('raceTrack').style.display = 'block';
                document.getElementById('startRaceBtn').style.display = 'inline-block';
                document.getElementById('results').style.display = 'block';
                
                // ÏûêÎèô ÏãúÏûë ÏòµÏÖò
                if (urlParams.get('autostart') === 'true') {
                    setTimeout(startRace, 1000);
                }
            } else {
                // Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù ÌôîÎ©¥ ÏÑ§Ï†ï
                setupCharacterSelection();
            }
        };
        
        // Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù ÌôîÎ©¥ ÏÑ§Ï†ï
        function setupCharacterSelection() {
            const characterSelect = document.getElementById('characterSelect');
            characterSelect.innerHTML = '';
            
            teamMembers.forEach(member => {
                const option = document.createElement('div');
                option.className = 'character-option';
                option.dataset.id = member.id;
                option.innerHTML = `
                    <img src="${member.img}" alt="${member.name}">
                    <p>${member.name}</p>
                `;
                option.addEventListener('click', () => toggleCharacterSelection(option, member));
                characterSelect.appendChild(option);
            });
            
            document.getElementById('confirmSelectionBtn').addEventListener('click', confirmSelection);
        }
        
        // Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù ÌÜ†Í∏Ä
        function toggleCharacterSelection(option, member) {
            const isSelected = option.classList.contains('selected');
            
            if (isSelected) {
                // ÏÑ†ÌÉù Ìï¥Ï†ú
                option.classList.remove('selected');
                selectedCharacters = selectedCharacters.filter(char => char.id !== member.id);
            } else {
                // ÏÑ†ÌÉù Ï∂îÍ∞Ä
                option.classList.add('selected');
                selectedCharacters.push(member);
            }
            
            // ÏÑ†ÌÉù Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('selectionInfo').textContent = `${selectedCharacters.length}Î™Ö ÏÑ†ÌÉùÎê®`;
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
            document.getElementById('confirmSelectionBtn').disabled = selectedCharacters.length === 0;
        }
        
        // ÏÑ†ÌÉù ÏôÑÎ£å
        function confirmSelection() {
            if (selectedCharacters.length === 0) {
                alert('ÏµúÏÜå 1Î™Ö Ïù¥ÏÉÅÏùò Ï∞∏Í∞ÄÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÏÑ†ÌÉùÎêú Ï∫êÎ¶≠ÌÑ∞Î•º Î†àÏù¥Ïä§ Ï∞∏Í∞ÄÏûêÎ°ú ÏÑ§Ï†ï
            raceParticipants = [...selectedCharacters];
            
            // ÏÑ†ÌÉù ÌôîÎ©¥ Ïà®Í∏∞Í≥† Î†àÏù¥Ïä§ ÌôîÎ©¥ ÌëúÏãú
            document.getElementById('selectionArea').style.display = 'none';
            setupRace();
            document.getElementById('raceTrack').style.display = 'block';
            document.getElementById('startRaceBtn').style.display = 'inline-block';
            document.getElementById('results').style.display = 'block';
            
            // URL ÏóÖÎç∞Ïù¥Ìä∏ (Ï∞∏Í∞ÄÏûê Ï†ïÎ≥¥ Ìè¨Ìï®)
            const url = new URL(window.location.href);
            url.searchParams.set('participants', raceParticipants.map(p => p.id).join(','));
            window.history.replaceState({}, '', url);
        }
        
        // Î†àÏù¥Ïä§ ÏÑ§Ï†ï
        function setupRace() {
            const raceTrack = document.getElementById('raceTrack');
            raceTrack.innerHTML = '';
            
            raceParticipants.forEach((char, index) => {
                const characterDiv = document.createElement('div');
                characterDiv.className = 'character';
                characterDiv.innerHTML = `
                    <div class="character-name">
                        ${char.name}
                    </div>
                    <div class="track">
                        <div class="runner" id="runner-${index}" style="position: absolute; left: 0; top: 0; height: 60px; display: flex; align-items: center; transition: left 0.1s ease-in-out;">
                            <img src="${char.img}" alt="${char.name}" style="width: 40px; height: 40px; border-radius: 50%;">
                        </div>
                        <div class="finish-line"></div>
                    </div>
                `;
                raceTrack.appendChild(characterDiv);
            });
            
            // Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
            document.getElementById('ranking').innerHTML = '';
            document.getElementById('winner').innerHTML = '';
            raceResults = [];
            raceFinished = false;
        }
        
        // Î†àÏù¥Ïä§ ÏãúÏûë
        function startRace() {
            if (raceFinished) return;
            
            document.getElementById('startRaceBtn').style.display = 'none';
            
            // Í∞Å Ï∫êÎ¶≠ÌÑ∞Ïùò Í∏∞Î≥∏ ÏÜçÎèÑ ÏÑ§Ï†ï (ÏïΩÍ∞ÑÏùò Ï∞®Ïù¥Î•º ÎëêÏñ¥ Ï¥àÍ∏∞ ÏÜçÎèÑ Îã§ÏñëÌôî)
            const baseSpeed = raceParticipants.map(() => Math.random() * 2 + 2); // Í∏∞Î≥∏ ÏÜçÎèÑ (2-4)
            
            const trackWidth = document.querySelector('.track').offsetWidth - 60; // runner ÎÑàÎπÑ(60px) Í≥†Î†§
            const finalStagePoint = trackWidth * 0.7; // ÎßàÏßÄÎßâ 30% Íµ¨Í∞ÑÏùò ÏãúÏûëÏ†ê
            
            let finishedCount = 0;
            
            const positions = Array(raceParticipants.length).fill(0);
            const finished = Array(raceParticipants.length).fill(false);
            
            // Î†àÏù¥Ïä§ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
            const updateRace = () => {
                raceParticipants.forEach((char, index) => {
                    if (finished[index]) return;
                    
                    let speedMultiplier;
                    
                    // ÎßàÏßÄÎßâ 30% Íµ¨Í∞ÑÏóêÏÑúÎäî Îçî Í∑πÏ†ÅÏù∏ ÏÜçÎèÑ Î≥ÄÌôî
                    if (positions[index] >= finalStagePoint) {
                        const random = Math.random();
                        
                        if (random < 0.10) {
                            // 10% ÌôïÎ•†Î°ú Í∞ïÎ†•Ìïú Í∞ÄÏÜç (2~2.5Î∞∞ ÏÜçÎèÑ)
                            speedMultiplier = 2 + Math.random() * 0.5;
                        } else if (random < 0.20) {
                            // 10% ÌôïÎ•†Î°ú Ïã¨Í∞ÅÌïú Í∞êÏÜç (0.2~0.4Î∞∞ ÏÜçÎèÑ)
                            speedMultiplier = 0.2 + Math.random() * 0.2;
                        } else {
                            // 80% ÌôïÎ•†Î°ú ÏïΩÍ∞ÑÏùò Î≥ÄÎèô (0.7~1.3Î∞∞ ÏÜçÎèÑ)
                            speedMultiplier = 0.7 + Math.random() * 0.6;
                        }
                    } else {
                        // ÏùºÎ∞ò Íµ¨Í∞ÑÏóêÏÑúÎäî ÏïΩÍ∞ÑÏùò ÏÜçÎèÑ Î≥ÄÌôîÎßå
                        speedMultiplier = 0.9 + Math.random() * 0.2; // 0.9~1.1Î∞∞ ÏÜçÎèÑ
                    }
                    
                    // Í∏∞Î≥∏ ÏÜçÎèÑÏóê ÎûúÎç§ Î≥ÄÎèô Ï†ÅÏö©
                    const step = baseSpeed[index] * speedMultiplier;
                    positions[index] += step;
                    
                    // ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
                    const runner = document.getElementById(`runner-${index}`);
                    runner.style.left = `${Math.min(positions[index], trackWidth)}px`;
                    
                    // ÎèÑÏ∞© ÌôïÏù∏
                    if (positions[index] >= trackWidth && !finished[index]) {
                        finished[index] = true;
                        const finishTime = Date.now(); // ÌòÑÏû¨ ÏãúÍ∞Ñ Í∏∞Î°ù
                        finishedCount++;
                        
                        // Í≤∞Í≥ºÏóê Ï∂îÍ∞Ä
                        raceResults.push({
                            index: index,
                            id: char.id,
                            name: char.name,
                            img: char.img,
                            time: finishTime
                        });
                        
                        // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
                        updateResults();
                        
                        // Î™®Îëê ÏôÑÏ£ºÌñàÎäîÏßÄ ÌôïÏù∏
                        if (finishedCount === raceParticipants.length) {
                            raceFinished = true;
                            clearInterval(raceInterval);
                            document.getElementById('newRaceBtn').style.display = 'inline-block';
                        }
                    }
                });
            };
            
            // 30msÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏó¨ Îçî Î∂ÄÎìúÎüΩÍ≤å Ïù¥Îèô
            const raceInterval = setInterval(updateRace, 30);
            runnerIntervals.push(raceInterval);
        }
        
        // Î™®Îì† Ïù∏ÌÑ∞Î≤å Ï†ïÎ¶¨
        function clearAllIntervals() {
            runnerIntervals.forEach(interval => clearInterval(interval));
            runnerIntervals = [];
        }
        
        // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        function updateResults() {
            // ÏôÑÏ£º ÏãúÍ∞Ñ Í∏∞Ï§Ä Ï†ïÎ†¨
            raceResults.sort((a, b) => a.time - b.time);
            
            const rankingDiv = document.getElementById('ranking');
            rankingDiv.innerHTML = '';
            
            raceResults.forEach((result, rank) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <img src="${result.img}" alt="${result.name}">
                    <span>${rank + 1}Îì±: ${result.name} (${((result.time - raceResults[0].time) / 1000).toFixed(2)}Ï¥à Ï∞®Ïù¥)</span>
                `;
                rankingDiv.appendChild(resultItem);
            });
            
            // Ïö∞ÏäπÏûê ÌëúÏãú
            if (raceResults.length > 0) {
                const winner = raceResults[0];
                document.getElementById('winner').innerHTML = `
                    <img src="${winner.img}" alt="${winner.name}">
                    <span>Ïö∞Ïäπ: ${winner.name}</span>
                `;
            }
        }
        
        // Í≤åÏûÑ Î¶¨ÏÖã
        function resetGame() {
            // Î™®Îì† Ïù∏ÌÑ∞Î≤å Ï†ïÎ¶¨
            clearAllIntervals();
            
            // Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
            document.getElementById('selectionArea').style.display = 'block';
            document.getElementById('raceTrack').style.display = 'none';
            document.getElementById('startRaceBtn').style.display = 'none';
            document.getElementById('newRaceBtn').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            
            // ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            selectedCharacters = [];
            document.querySelectorAll('.character-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('selectionInfo').textContent = '0/5Î™Ö ÏÑ†ÌÉùÎê®';
            document.getElementById('confirmSelectionBtn').disabled = true;
            
            // URL Ï¥àÍ∏∞Ìôî
            const url = new URL(window.location.href);
            url.searchParams.delete('seed');
            url.searchParams.delete('participants');
            url.searchParams.delete('autostart');
            window.history.replaceState({}, '', url);
            
            raceID = generateRaceID();
        }
        
        // Í≥†Ïú† Î†àÏù¥Ïä§ ID ÏÉùÏÑ±
        function generateRaceID() {
            return Math.random().toString(36).substring(2, 8);
        }
        
        // Î†àÏù¥Ïä§ Í≥µÏú† URL ÏÉùÏÑ±
        function getShareURL() {
            const seed = Math.random().toString(36).substring(2, 10);
            const baseUrl = window.location.href.split('?')[0];
            const participantIds = raceParticipants.map(p => p.id).join(',');
            return `${baseUrl}?seed=${seed}&participants=${participantIds}&autostart=true`;
        }
        
        // Math.random ÏãúÎìú Ìï®Ïàò (Ïô∏Î∂Ä ÎùºÏù¥Î∏åÎü¨Î¶¨)
        // Ï∂úÏ≤ò: https://github.com/davidbau/seedrandom
        (function (global, pool, math) {
            math['seedrandom'] = function(seed, options, callback) {
                var key = [];
                options = (options == true) ? { entropy: true } : (options || {});
                
                var shortseed = mixkey(seed ? seed : pool,
                    pool.length);
                
                return (function(prng) {
                    var orig = math.random;
                    
                    prng.next = function() {
                        var n = 2091639 * prng.g1 + prng.g2 * 2.3283064365386963e-10;
                        prng.g2 = prng.g1;
                        return prng.g1 = n - (prng.g1 = n | 0);
                    };
                    
                    math.random = function() {
                        return prng.next();
                    };
                    
                    return prng;
                })(
                    new function() {
                        this.g1 = 1;
                        this.g2 = shortseed;
                    }()
                );
            };
            
            function mixkey(seed, key) {
                var stringseed = seed + '';
                var smear = 0;
                for (var j = 0; j < stringseed.length; ++j) {
                    var k = key.length;
                    smear ^= key[j % k] + stringseed.charCodeAt(j);
                }
                return (smear >>> 0) / 4294967296;
            }
        })(
            this,
            [],
            Math
        );
    </script>
</body>
</html>